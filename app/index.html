<html>

<head>
    <title>Vue JS</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,400italic">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://unpkg.com/vue-material/dist/vue-material.css">
    <link href="https://fonts.googleapis.com/css?family=Mitr:500" rel="stylesheet">
    <script src="https://unpkg.com/vue"></script>
    <script src="https://unpkg.com/vue-material"></script>
</head>

<body>
    <div id="app">
        <md-toolbar>
            <h1 class="md-title">My Title</h1>
        </md-toolbar>

        <div class="main-content">
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Quo, rerum? Error sunt, aperiam dolores, atque expedita
                molestiae tenetur. Quis eveniet accusamus velit explicabo adipisci reiciendis modi eaque quas, officia excepturi.</p>
        </div>

        <md-button class="md-raised md-primary">Button</md-button>

        <a id="download">Download as image</a>

        <input v-model="exampleContent">

        <canvas id="viewport" width="1200" height="900" style="padding: 10px; border:1px;" v-insert-message="exampleContent"></canvas>
    </div>
    <script>
        Vue.use(VueMaterial)

        var size = 24
        var height = 434;
        var dataURL;

        var App = new Vue({
            el: '#app',
            data: {
                "exampleContent": "This is TEXT"
            },
            directives: {
                insertMessage: function (canvasElement, binding) {
                    var canvas = document.getElementById('viewport')
                    var ctx = canvasElement.getContext("2d");
                    // Clear the canvas
                    //ctx.clearRect(0, 0, 1200, 900);
                    // Insert stuff into canvas
                    base_image = new Image();
                    base_image.src = 'template/result-template.jpg';
                    ctx.drawImage(base_image, 0, 0);
                    ctx.font = size + 'pt "Mitr"';
                    ctx.fillStyle = 'white';
                    ctx.textAlign = "center";
                    ctx.fillText(binding.value, 347, height);

                    if (ctx.measureText(binding.value).width == 0) {
                        size = 24
                        height = 434
                    }

                    if (ctx.measureText(binding.value).width >= 273) {
                        size -= 1
                        height -= 0.33
                    }
                    else if (size < 24) {
                        size += 1
                        height += 0.33
                    }
                    dataURL = document.getElementById('viewport').toDataURL();

                    document.getElementById('download').addEventListener('click', function () {
                        downloadCanvas(this, 'test.png');
                    }, false);
                }
            },
        })

        function downloadCanvas(link, filename) {
            link.href = dataURL;
            link.download = filename;
        }


        console.log(dataURL)
    </script>
</body>

</html>